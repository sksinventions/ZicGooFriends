@page "/login"
@using Newtonsoft.Json
@using System.Text
@using System.Net
@inject NavigationManager NavManager

<EditForm Model="user" OnSubmit="Submit_hdlr">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group mb-3">
        <label class="form-label">User name : </label>
        <InputText id="loginID" class="form-control" @bind-Value="user.AccountID" placeholder="Input your account.." />
    </div>
    
    <div class="form-group mb-5">
        <label class="form-label">Password : </label>
        <InputText id="loginPW" class="form-control" @bind-Value="user.Password" placeholder="Input your password.." type="password"/>
    </div>

    <div class="form-group">
        <p style="color:@InfoColor"><b>@InfoTxt</b></p>
    </div>

    <button type="submit" class="btn btn-primary">Log In</button>
</EditForm>

@code {
    private UserModel user = new UserModel();
    private string InfoColor = "black";
    private string InfoTxt = "";

    public async void Submit_hdlr()
    {
        if (String.IsNullOrEmpty(user.AccountID))
        {
            InfoColor = "red";
            InfoTxt = "Please input Account ID";
            return;
        }

        using (HttpClient httpClient = new HttpClient())
        {
            string jsonStr = JsonConvert.SerializeObject(user);
            StringContent content = new StringContent(jsonStr, UnicodeEncoding.UTF8,"application/json");
            string uri = @"https://localhost:7263/login";
            HttpResponseMessage response = await httpClient.PostAsync(uri,content);
            if (response.StatusCode == HttpStatusCode.OK)
            {
                string result = await response.Content.ReadAsStringAsync();
            }
        }

        NavManager.NavigateTo("/");
    }
}
